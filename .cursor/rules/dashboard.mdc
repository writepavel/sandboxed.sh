---
description: Dashboard (Next.js + Bun) conventions
globs: ["dashboard/**"]
---

# Dashboard Conventions

## Package Manager: Bun (not npm/yarn/pnpm)

```bash
cd dashboard
bun install          # install deps
bun dev              # dev server on :3001
bun run build        # production build
bun add <package>    # add dependency (gets latest version)
```

## Stack

| Tech | Version | Purpose |
|------|---------|---------|
| Next.js | 16.x | React framework |
| React | 19.x | UI library |
| Tailwind | 4.x | Styling |
| Bun | 1.3+ | Package manager + runtime |
| xterm | 5.x | Terminal emulator |

## API Communication

```typescript
// All API calls go through lib/api.ts
const API_BASE = process.env.NEXT_PUBLIC_API_URL ?? 'http://127.0.0.1:3000';

// Auth: JWT stored in sessionStorage
const token = sessionStorage.getItem('jwt');
headers: { 'Authorization': `Bearer ${token}` }

// SSE streaming (uses fetch, not EventSource, for auth headers)
```

## Directory Structure

```
dashboard/src/
├── app/              # Next.js App Router pages
│   ├── console/      # SSH terminal + file explorer
│   ├── control/      # Task control panel
│   ├── agents/       # Agent monitoring
│   ├── modules/      # MCP module management
│   └── settings/     # Configuration
├── components/
│   ├── ui/           # Generic UI components
│   └── tool-ui/      # Tool-specific UI (option-list, data-table)
├── hooks/            # React hooks
└── lib/              # Utilities (api, auth, settings)
```

## Environment Variables

Dashboard uses `.env.local`:
```
NEXT_PUBLIC_API_URL=http://127.0.0.1:3000
```

## Auth Flow

1. Dashboard checks `/api/health` for `auth_required`
2. If required, prompts password → `POST /api/auth/login`
3. Stores JWT + expiry in `sessionStorage`
4. Sends `Authorization: Bearer <jwt>` on all requests
5. WebSocket auth: uses subprotocol `["openagent", "jwt.<token>"]`

## Icons

Use Lucide React (`lucide-react`), not Remix Icons:
```tsx
import { Home, Settings, Play } from 'lucide-react';
<Home className="h-4 w-4" />
```

## Ports

| Service | Port |
|---------|------|
| Backend API | 3000 |
| Dashboard | 3001 |
