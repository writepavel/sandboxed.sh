try{let u=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},g=new u.Error().stack;g&&(u._sentryDebugIds=u._sentryDebugIds||{},u._sentryDebugIds[g]="f82feed0-785a-4db0-a22d-81c13f1586c7",u._sentryDebugIdIdentifier="sentry-dbid-f82feed0-785a-4db0-a22d-81c13f1586c7")}catch{}{let u=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};u.SENTRY_RELEASE={id:"2.66.0"}}(self.webpackChunkbrowser_extension_wallet=self.webpackChunkbrowser_extension_wallet||[]).push([[3003],{83003:((u,g,e)=>{e.r(g),e.d(g,{default:()=>ae});var x=e(74848),J=e(2496),V=e(29584),X=e(63369),Z=e(23688),D=e(68157),k=e(52856),$=e(97665),q=e(6475),o=e(96540),w=e(22670),L=e(62266),F=e(64145),_=e(33055);const ee=()=>{const{tx:r,wallet:l}=D.M_.getState();return(0,o.useMemo)(()=>{var t,n,c;return(c=(n=(t=r.fetchedAllChainsTransactionPeriodsByAccount)==null?void 0:t[l.walletId])==null?void 0:n[l.selectedAccountId])!=null?c:{}},[r.fetchedAllChainsTransactionPeriodsByAccount,l.walletId,l.selectedAccountId])};var m=e(85005),te=e(10537),ne=e(9389),p=(r,l,t)=>new Promise((n,c)=>{var y=s=>{try{T(t.next(s))}catch(S){c(S)}},h=s=>{try{T(t.throw(s))}catch(S){c(S)}},T=s=>s.done?n(s.value):Promise.resolve(s.value).then(y,h);T((t=t.apply(r,l)).next())});const A=29;function se(){const r=(0,_.v)(),l=(0,ne.Cb)(),{from:t,to:n,blockchains:c,nextToken:y}=ee(),h=(0,te.n)(!0),T=(0,$.jE)(),[s,S]=(0,o.useState)(new Date),[d,R]=(0,o.useState)((0,m.t6)(new Date,A)),[Y,G]=(0,o.useState)(!1),[Q,W]=(0,o.useState)(!1),[I,ce]=(0,o.useState)(y),[K,re]=(0,o.useState)([]),[E,de]=(0,o.useState)(!0),O=(0,o.useRef)(0),b=(0,o.useMemo)(()=>h.filter(i=>!K.includes(i.id)),[h,K]),ue=(0,o.useCallback)(()=>{!t||!n||!E||new Date(t)<new Date(d)&&p(null,null,function*(){yield F.YW.emit(w.A.FETCH_ALL_CHAINS_MISSING_TRANSACTIONS,{from:s,to:t,blockchains:b}),S(new Date(n)),R((0,m.t6)(new Date(n),A)),G(!0)})},[t,n,s,d]),fe=(0,o.useCallback)(i=>{if(!E)return;p(null,null,function*(){yield F.YW.emit(w.A.FETCH_ALL_CHAINS_MISSING_TRANSACTIONS,{from:new Date(t),to:new Date(n),blockchains:i})})},[]),M=(i,a,f)=>{ce(f),D.M_.dispatch(k.B.actions.updateAllChainsCachedTransactionsPeriod({blockchains:b.map(P=>P.id),selectedWalletId:r,accountId:l,from:i,to:a,nextToken:f}))},he=i=>p(null,[i],function*({pageParam:a}){O.current++;const{transactions:f,nextToken:P,unsupportedChains:C}=yield F.YW.emit(w.A.FETCH_ASSETS_TRANSACTION_HISTORY,{from:a.from,to:a.to,nextToken:a.nextToken,blockchains:b});let B=a.from,H=a.to,N=P;if(f?.length&&D.M_.dispatch(k.B.actions.updateTxs({items:f,walletId:r,accountId:l})),C?.length&&(re(C),c?.length)){const z=h.filter(j=>!C.includes(j.id)).filter(j=>!c.includes(j.id));z.length>0&&fe(z)}return t||M(s.toISOString(),d.toISOString()),a.from>new Date(t)&&d<new Date(t)&&(M(s.toISOString(),n,I),B=(0,m.t6)(new Date(n),-A),H=new Date(n),N=void 0),(a.to<new Date(n)||new Date(n).getTime()===a.to.getTime()&&N!==I)&&M(t,d.toISOString(),N),Y&&G(!1),S(B),R(H),W(!f?.length),ue(),{transactions:f,from:B,to:H,nextToken:N}}),{fetchNextPage:U,hasNextPage:Te,isFetchingNextPage:ve}=(0,q.q)({queryKey:["transactions",r],queryFn:he,refetchOnWindowFocus:!1,refetchOnReconnect:!1,staleTime:1e3*60*5,gcTime:1e3*60*60*24,enabled:E,initialPageParam:{from:s,to:d,nextToken:void 0},getNextPageParam:i=>{var a;if(!(d<=L.Qp||i===null))return Y?{from:s,to:d,nextToken:I}:i.nextToken||I?{nextToken:(a=i.nextToken)!=null?a:I,from:s,to:d}:{from:new Date(i.to.getTime()),to:(0,m.t6)(i.to,A)}}});return(0,o.useEffect)(()=>{Q&&O.current>1&&d>L.Qp&&U(),W(!1)},[Q]),(0,o.useEffect)(()=>()=>{T.removeQueries(),de(!1)},[]),{fetchNextPage:U,hasNextPage:Te,isFetchingNextPage:ve,isFirstFetch:O.current<2}}var oe=e(69325),v=e(4800),le=e(67310),ie=e(6442);const ae=(0,Z.K)(()=>{(0,X.K)({event:V.Un.HISTORY,props:null});const{formatMessage:r}=(0,ie.A)(),l=(0,oe.q)(),t=window.innerHeight-v.a4-v.e4-v.Et-64,[n,c]=(0,o.useState)(!0),{fetchNextPage:y,hasNextPage:h,isFetchingNextPage:T,isFirstFetch:s}=se();return(0,o.useEffect)(()=>{(Object.keys(l).length||!s)&&c(!1)},[l]),(0,x.jsxs)(v.LN,{children:[(0,x.jsx)(v.zY,{title:r({id:"history-list.title"})}),(0,x.jsx)(v.Gv,{children:(0,x.jsx)(le.A,{dataLength:Object.values(l).flat().length,next:y,height:t,className:"tw-scrollbar",hasMore:!!h,loader:null,style:{display:"flex",flexDirection:"column"},children:(0,x.jsx)(J.D,{transactions:l,scrollableAreaHeight:t,loadMoreItems:y,fetchingTransactions:T||n,hasNextPage:h,historyAvailable:!0})})})]})})})}]);

//# sourceMappingURL=3003.js.map