try{let z=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},K=new z.Error().stack;K&&(z._sentryDebugIds=z._sentryDebugIds||{},z._sentryDebugIds[K]="7e3db100-9e96-4b94-8820-e7fd99a259d2",z._sentryDebugIdIdentifier="sentry-dbid-7e3db100-9e96-4b94-8820-e7fd99a259d2")}catch{}{let z=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};z.SENTRY_RELEASE={id:"2.66.0"}}(self.webpackChunkbrowser_extension_wallet=self.webpackChunkbrowser_extension_wallet||[]).push([[712],{2472:((z,K,o)=>{o.d(K,{i:()=>v});var t=o(74848),V=o(48346);const v=({length:Z,isLoading:q,widthClass:h="w-20",heightClass:G="h-4",horizontal:H=!1,fullWidth:se=!1})=>q?(0,t.jsx)("div",{className:`flex ${H?"flex-row":"flex-col"} gap-2`,children:[...Array(Z)].map((he,Pe)=>(0,t.jsx)(V.S,{isLoading:!0,widthClass:h,heightClass:G,fullWidth:se},"skeleton-line-list-"+Pe))}):null}),6475:((z,K,o)=>{o.d(K,{q:()=>q});var t=o(1651),V=o(58959),v=class extends t.${constructor(h,G){super(h,G)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(h,G){super.setOptions({...h,behavior:(0,V.PL)()},G)}getOptimisticResult(h){return h.behavior=(0,V.PL)(),super.getOptimisticResult(h)}fetchNextPage(h){return this.fetch({...h,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(h){return this.fetch({...h,meta:{fetchMore:{direction:"backward"}}})}createResult(h,G){const{state:H}=h,se=super.createResult(h,G),{isFetching:he,isRefetching:Pe,isError:W,isRefetchError:le}=se,ie=H.fetchMeta?.fetchMore?.direction,ee=W&&ie==="forward",xe=he&&ie==="forward",re=W&&ie==="backward",Se=he&&ie==="backward";return{...se,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:(0,V.rB)(G,H.data),hasPreviousPage:(0,V.RQ)(G,H.data),isFetchNextPageError:ee,isFetchingNextPage:xe,isFetchPreviousPageError:re,isFetchingPreviousPage:Se,isRefetchError:le&&!ee&&!re,isRefetching:Pe&&!xe&&!Se}}},Z=o(44171);function q(h,G){return(0,Z.t)(h,v,G)}}),38331:((z,K,o)=>{o.r(K),o.d(K,{default:()=>en});var t=o(74848),V=o(84976),v=o(47767),Z=o(4800),q=o(6442),h=o(96540),G=o(49051),H=o(52619),se=o(65512),he=o(48346),Pe=o(2472),W=o(26264),le=(e=>(e.REGULAR="regular",e.P2P="p2p",e))(le||{});const ie=(0,h.createContext)(null),ee=()=>{const e=(0,h.useContext)(ie);if(!e)throw new Error("useBuyContext must be inside BuyContextProvider");return e};var xe=o(63369),re=o(29584),Se=o(41327),T=o(52114),g=o(1279);const k=({quote:e,paymentCategory:s,isLoading:n,onClick:a})=>{var r;const{formatMessage:l}=(0,q.A)();if(n)return(0,t.jsxs)("div",{className:"flex items-center justify-between w-full py-3 px-4 bg-background-secondary rounded-4 animate-pulse",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-10 h-10 rounded-full bg-background-tertiary"}),(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)("div",{className:"w-[100px] h-4 bg-background-tertiary rounded"}),(0,t.jsx)("div",{className:"w-[80px] h-3.5 bg-background-tertiary rounded"})]})]}),(0,t.jsx)("div",{className:"w-5 h-5 bg-background-tertiary rounded"})]});if(!e)return null;const c=e.provider.name,i=e.provider.imageUrl,d=(r=s?.displayName)!=null?r:e.paymentMethod.paymentMethod;return(0,t.jsx)(se.$,{onClick:a,theme:H.ry.SECONDARY,shape:H.dB.DEFAULT,className:"flex items-center justify-between py-3 px-4 bg-background-secondary rounded-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[i?(0,t.jsx)("img",{src:i,alt:c,className:"w-10 h-10"}):(0,t.jsx)("div",{className:"w-10 h-10 rounded-full bg-background-primary flex items-center justify-center",children:(0,t.jsx)(T.E,{type:g.jK.SUBHEADER_16,weight:g.nG.SEMIBOLD,children:c.charAt(0)})}),(0,t.jsxs)("div",{className:"flex flex-col items-start",children:[(0,t.jsx)(T.E,{type:g.jK.SUBHEADER_16,weight:g.nG.SEMIBOLD,children:d}),(0,t.jsx)(T.E,{type:g.jK.BODY_14,theme:g.Il.UTILITY_1_OPACITY_1,children:l({id:"buy-enter-amount.p2p-provider",defaultMessage:"with {providerName}"},{providerName:c})})]})]}),(0,t.jsx)(Se.v,{width:20,height:20,colorClass:"text-icon-secondary"})]})})};var U=o(97286),Y=o(64145),$=o(23384),de=(e=>(e.DIRECT="DIRECT",e.INDIRECT="INDIRECT",e.BINANCE_INDIRECT="BINANCE_INDIRECT",e))(de||{}),X=(e=>(e.KYCed="KYCed",e.LastUsed="LastUsed",e.IsRecommended="IsRecommended",e.BestPrice="BestPrice",e.ProviderDefaultForRegion="ProviderDefaultForRegion",e))(X||{});const te=({assetId:e,currency:s,amount:n,enabled:a=!0,isP2P:r=!1})=>{var l,c,i,d,y;const m=a&&!!e&&!!s&&!!n&&n!=="0",{data:x,isPending:S,isFetching:Q,isError:D,error:w,refetch:A}=(0,U.I)({queryKey:["buy-provider-routes",e,s,n],queryFn:()=>{const _={assetId:e,currency:s,amount:n};return Y.YW.emit($.A.GET_BUY_PROVIDER_ROUTES,_)},enabled:m&&!r,retry:2,refetchOnWindowFocus:!1,gcTime:1e3*60*5}),{data:E,isPending:b,isFetching:P,isError:B,error:L,refetch:J}=(0,U.I)({queryKey:["p2p-buy-quotes",e,s,n],queryFn:()=>Y.YW.emit($.A.GET_P2P_BUY_CRYPTO_QUOTES,{assetId:e,amount:n,currency:s}),enabled:m&&r,retry:2,refetchOnWindowFocus:!1,gcTime:1e3*60*5}),F=r?b:S,N=r?P:Q,f=r?B:D,u=r?L:w,p=r?J:A,I=(l=E?.quotes)!=null?l:[],C=(i=(c=x?.onramp)==null?void 0:c.quotes)!=null?i:[],R=(y=(d=x?.onramp)==null?void 0:d.paymentCategories)!=null?y:[],O=!C.length||!R.length?[]:R.map(_=>{var fe;const ve=[...C.filter(ge=>ge.paymentMethod.categoryId===_.id)].sort((ge,Le)=>{if(ge.isRecommended&&!Le.isRecommended)return-1;if(!ge.isRecommended&&Le.isRecommended)return 1;const et=ge.badges.includes(X.BestPrice),tt=Le.badges.includes(X.BestPrice);return et&&!tt?-1:!et&&tt?1:Le.digitalMoney.amount-ge.digitalMoney.amount}),sn=(fe=ve.find(ge=>ge.isRecommended))!=null?fe:ve[0];return{category:_,quotes:ve,recommendedQuote:sn}}).filter(_=>_.quotes.length>0),j=()=>{if(!C.length)return;const _=C.find(me=>me.isRecommended);if(_)return _;const fe=C.find(me=>me.badges.includes(X.BestPrice));return fe||C.reduce((me,ve)=>ve.digitalMoney.amount>me.digitalMoney.amount?ve:me,C[0])},ce=()=>{if(I.length)return I[0]},ue=j(),ne=ce(),tn=(()=>{var _;if(O.length){if(ue){const fe=O.find(me=>me.quotes.some(ve=>ve.id===ue.id));if(fe)return fe.category}return(_=O[0])==null?void 0:_.category}})(),qe=x?.routeType,nn=r?I.length>0:qe===de.DIRECT;return{providerRoutes:x,routeType:qe,isDirectRoute:nn,allQuotes:C,paymentCategories:R,providersByCategory:O,bestQuote:ue,defaultCategory:tn,p2pQuotes:I,p2pBestQuote:ne,isLoading:F,isFetching:N,isError:f,error:u,refetch:p}};var Ae=o(73900);const Ce=({isValidFiatAmount:e,selectedFiat:s,formatMessage:n})=>{if(!e)return{isValid:!0,error:null};const a=parseFloat(s.amount);if(isNaN(a))return{isValid:!0,error:null};const{minAmount:r,maxAmount:l,symbol:c}=s;return!r||!l?{isValid:!0,error:null}:a<r?{isValid:!1,error:{type:"min",message:n({id:"buy-enter-amount.min-amount-error",defaultMessage:"Min amount is {amount} {currency}"},{amount:r.toLocaleString(void 0,{maximumFractionDigits:2}),currency:c})}}:a>l?{isValid:!1,error:{type:"max",message:n({id:"buy-enter-amount.max-amount-error",defaultMessage:"Max amount is {amount} {currency}"},{amount:l.toLocaleString(void 0,{maximumFractionDigits:2}),currency:c})}}:{isValid:!0,error:null}};var oe=o(42430),ae=o(53982),Ee=o(57097),Ie=o(89408),Me=o(42564),Oe=o(28398),je=o(23207),Te=Object.defineProperty,Ne=Object.defineProperties,nt=Object.getOwnPropertyDescriptors,we=Object.getOwnPropertySymbols,st=Object.prototype.hasOwnProperty,rt=Object.prototype.propertyIsEnumerable,Ue=(e,s,n)=>s in e?Te(e,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[s]=n,ot=(e,s)=>{for(var n in s||(s={}))st.call(s,n)&&Ue(e,n,s[n]);if(we)for(var n of we(s))rt.call(s,n)&&Ue(e,n,s[n]);return e},at=(e,s)=>Ne(e,nt(s)),Ye=(e,s,n)=>new Promise((a,r)=>{var l=d=>{try{i(n.next(d))}catch(y){r(y)}},c=d=>{try{i(n.throw(d))}catch(y){r(y)}},i=d=>d.done?a(d.value):Promise.resolve(d.value).then(l,c);i((n=n.apply(e,s)).next())});const lt=()=>{const{trackAnalytics:e}=(0,je.s)(),s=a=>({id:a.id,isRecommended:a.isRecommended,digitalMoney:a.digitalMoney,fiatMoney:a.fiatMoney,provider:a.provider,paymentMethod:{paymentMethod:a.paymentMethod.paymentMethod,providerName:a.paymentMethod.providerName}});return(0,Ee.n)({mutationFn:a=>Ye(null,[a],function*({quote:r,asset:l}){var c;const i=s(r),d=yield Y.YW.emit($.A.BUY_CRYPTO,{quote:i,assetId:l.assetId});if((c=d.error)!=null&&c.message)throw new Error(d.error.message);return{response:d,quote:r,asset:l}}),onSuccess:a=>Ye(null,[a],function*({response:r,quote:l,asset:c}){const{url:i,addressField:d,address:y}=r,m=new URL(i);d&&m.searchParams.set(d,y);for(const[x,S]of m.searchParams)x==="address"&&m.searchParams.set(x,(0,Me.d)(S));window.open(m.toString(),"_blank"),e({event:re.Un.FIAT_ON_RAMPS_PROVIDER,props:{pageViewResourceType:re.Rb.EXTERNAL,blockchainId:c.blockchainId,assetCurrency:l.digitalMoney.currency,assetAmount:l.digitalMoney.amount,assetFiatCurrency:l.fiatMoney.currency,assetFiatAmount:l.fiatMoney.amount,providerName:l.provider.name,paymentMethod:l.paymentMethod.paymentMethod,subPaymentMethod:l.paymentMethod.providerName}}),c.isShownInHomeScreen||(yield Y.YW.emit(Ie.A.ADD_ASSET,{asset:at(ot({},c),{isShownInHomeScreen:!0}),blockchainType:Oe.l.MAIN}))})})};var it=Object.defineProperty,dt=Object.defineProperties,ct=Object.getOwnPropertyDescriptors,Qe=Object.getOwnPropertySymbols,ut=Object.prototype.hasOwnProperty,mt=Object.prototype.propertyIsEnumerable,We=(e,s,n)=>s in e?it(e,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[s]=n,yt=(e,s)=>{for(var n in s||(s={}))ut.call(s,n)&&We(e,n,s[n]);if(Qe)for(var n of Qe(s))mt.call(s,n)&&We(e,n,s[n]);return e},pt=(e,s)=>dt(e,ct(s)),Ge=(e,s,n)=>new Promise((a,r)=>{var l=d=>{try{i(n.next(d))}catch(y){r(y)}},c=d=>{try{i(n.throw(d))}catch(y){r(y)}},i=d=>d.done?a(d.value):Promise.resolve(d.value).then(l,c);i((n=n.apply(e,s)).next())});const ft=()=>{const{trackAnalytics:e}=(0,je.s)();return(0,Ee.n)({mutationFn:n=>Ge(null,[n],function*({quote:a,asset:r}){return{response:yield Y.YW.emit($.A.GET_P2P_BUY_CRYPTO_CHECKOUT,{quoteId:a.id,assetId:r.assetId}),quote:a,asset:r}}),onSuccess:n=>Ge(null,[n],function*({response:a,quote:r,asset:l}){const{url:c}=a;window.open(c,"_blank"),e({event:re.Un.FIAT_ON_RAMPS_PROVIDER,props:{pageViewResourceType:re.Rb.EXTERNAL,blockchainId:l.blockchainId,assetCurrency:r.digitalMoney.currency,assetAmount:r.digitalMoney.amount,assetFiatCurrency:r.fiatMoney.currency,assetFiatAmount:r.fiatMoney.amount,providerName:r.provider.name,paymentMethod:r.paymentMethod.paymentMethod,subPaymentMethod:r.paymentMethod.providerName}}),l.isShownInHomeScreen||(yield Y.YW.emit(Ie.A.ADD_ASSET,{asset:pt(yt({},l),{isShownInHomeScreen:!0}),blockchainType:Oe.l.MAIN}))})})};var vt=Object.defineProperty,gt=Object.defineProperties,ht=Object.getOwnPropertyDescriptors,Ke=Object.getOwnPropertySymbols,Pt=Object.prototype.hasOwnProperty,xt=Object.prototype.propertyIsEnumerable,Ve=(e,s,n)=>s in e?vt(e,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[s]=n,He=(e,s)=>{for(var n in s||(s={}))Pt.call(s,n)&&Ve(e,n,s[n]);if(Ke)for(var n of Ke(s))xt.call(s,n)&&Ve(e,n,s[n]);return e},ke=(e,s)=>gt(e,ht(s));const At=()=>{var e,s,n,a,r,l,c;(0,xe.K)({event:re.Un.FIAT_ON_RAMPS,props:null});const{formatMessage:i}=(0,q.A)(),d=(0,v.Zp)(),{selectedCrypto:y,selectedFiat:m,setSelectedFiat:x,selectedProvider:S,setSelectedProvider:Q,selectedPaymentCategory:D,setSelectedPaymentCategory:w,isP2PBuy:A}=ee(),E=()=>A?"?mode=p2p":"",b=!!y?.assetId&&!!m?.amount&&m.amount!=="0",{bestQuote:P,p2pBestQuote:B,defaultCategory:L,isDirectRoute:J,isLoading:F}=te({assetId:(e=y?.assetId)!=null?e:"",currency:(s=m?.symbol)!=null?s:"USD",amount:(n=m?.amount)!=null?n:"0",enabled:b,isP2P:A}),N=lt(),f=ft();(0,h.useEffect)(()=>{P&&!S&&Q(P),L&&!D&&w(L)},[P,L,S,D,Q,w]);const u=S??P,p=A?B?.digitalMoney.amount.toFixed(6):u?.digitalMoney.amount.toFixed(6),I=()=>{d(-1)},C=ne=>{x(ke(He({},m),{amount:ne.toString()}))},R=()=>{y&&(A&&B?f.mutate({quote:B,asset:y}):u&&N.mutate({quote:u,asset:y}))},M=m.amount!==""&&m.amount!=="0",O=Ce({isValidFiatAmount:M,selectedFiat:m,formatMessage:i}),j=m.suggestedAmounts&&m.suggestedAmounts.length>0,ce=A?(r=(a=f.error)==null?void 0:a.message)!=null?r:null:(c=(l=N.error)==null?void 0:l.message)!=null?c:null,ue=A?f.isPending:N.isPending;return(0,t.jsx)(Z.LN,{wide:!0,children:(0,t.jsxs)("div",{className:"flex flex-col justify-between flex-1",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,t.jsx)(Z.zY,{backAction:I,title:i({id:"fund.buy-crypto.title",defaultMessage:"Buy crypto"})}),(0,t.jsx)(oe.A,{vipBenefitsId:ae.n.ONRAMP_FEE_DISCOUNT})]}),(0,t.jsxs)(Z.Gv,{className:"flex flex-col items-end gap-8 justify-center",children:[(0,t.jsx)(G.y,{asset:m,amount:m.amount,onAmountChange:ne=>x(ke(He({},m),{amount:ne})),onAssetClick:()=>d(W.b.BUY_NEW+"/select-fiat"+E())}),(0,t.jsx)(G.y,{asset:y,amount:p,onAssetClick:()=>d(W.b.BUY_NEW+"/select-crypto"+E()),isLoading:M&&F,isEditable:!1})]}),(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsxs)("div",{className:"grid grid-cols-4 gap-1.5 mb-6 h-[26px] items-center",children:[(0,t.jsx)(Pe.i,{length:4,widthClass:"w-full",heightClass:"h-9",fullWidth:!0,isLoading:!j,horizontal:!0}),j&&m.suggestedAmounts.map((ne,pe)=>(0,t.jsx)(se.$,{size:H.Vp.SMALL,onClick:()=>C(ne),fullWidth:!0,theme:H.ry.SUBTLE,className:"font-semibold ",children:ne},"suggested-amount-"+pe))]}),(0,t.jsx)("div",{className:"mb-4",children:M?O.error?(0,t.jsxs)("div",{className:"flex items-center gap-2 py-5 px-4 bg-error-background rounded-4",children:[(0,t.jsx)(Ae.U,{width:14,height:14,colorClass:"text-error-main"}),(0,t.jsx)(T.E,{theme:g.Il.ERROR,type:g.jK.BODY_14,weight:g.nG.SEMIBOLD,children:O.error.message})]}):F?(0,t.jsx)(he.S,{isLoading:!0,widthClass:"w-full",heightClass:"h-16",fullWidth:!0}):A&&B?(0,t.jsx)("div",{className:"flex items-center py-3 px-4 bg-background-secondary rounded-4",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[B.provider.imageUrl&&(0,t.jsx)("img",{src:B.provider.imageUrl,alt:B.provider.name,className:"w-10 h-10"}),(0,t.jsxs)("div",{className:"flex flex-col items-start",children:[(0,t.jsx)(T.E,{type:g.jK.SUBHEADER_16,weight:g.nG.SEMIBOLD,children:"P2P"}),(0,t.jsx)(T.E,{type:g.jK.BODY_14,theme:g.Il.UTILITY_1_OPACITY_1,children:i({id:"buy-enter-amount.p2p-provider",defaultMessage:"with {providerName}"},{providerName:B.provider.name})})]})]})}):J?(0,t.jsx)(k,{quote:u,paymentCategory:D,isLoading:!1,onClick:()=>d(W.b.BUY_NEW+"/select-provider")}):(0,t.jsx)("div",{className:"flex items-center justify-center py-3 px-4 bg-background-secondary rounded-xl",children:(0,t.jsx)(T.E,{type:g.jK.BODY_14,theme:g.Il.SECONDARY,children:i({id:"buy-enter-amount.no-payment-method",defaultMessage:"No available payment method"})})}):(0,t.jsx)("div",{className:"flex items-center justify-center py-3 px-4 bg-background-secondary rounded-xl",children:(0,t.jsx)(T.E,{type:g.jK.BODY_14,theme:g.Il.SECONDARY,children:i({id:"buy-enter-amount.enter-amount",defaultMessage:"Enter amount"})})})}),ce&&(0,t.jsxs)("div",{className:"flex items-center gap-2 py-3 px-4 bg-error-background rounded-4 mb-4",children:[(0,t.jsx)(Ae.U,{width:14,height:14,colorClass:"text-error-main"}),(0,t.jsx)(T.E,{theme:g.Il.ERROR,type:g.jK.BODY_14,weight:g.nG.SEMIBOLD,children:ce})]}),(0,t.jsx)(se.$,{size:H.Vp.LARGE,shape:H.dB.DEFAULT,theme:H.ry.PRIMARY,onClick:R,disabled:!M||!O.isValid||!J||ue,loading:ue,children:i({id:"fund.buy-crypto-button",defaultMessage:"{label}"},{label:M?"Continue":"Enter amount"})})]})]})})},ze=e=>{const{data:s,isFetching:n,error:a,refetch:r}=(0,U.I)({queryKey:["currency-config",e],queryFn:()=>Y.YW.emit($.A.ONE_CLICK_BUY_CRYPTO_CONFIG,{assetId:e}),enabled:!!e,retry:2,refetchOnWindowFocus:!1,staleTime:3e5,gcTime:6e5});return{currencies:s??[],isLoading:n&&!s,error:a,refetch:r}};var Be=o(25160),be=(e=>(e.DEFAULT="Default",e.LOCAL="Local",e.LAST_USED="LastUsed",e.POPULAR="Popular",e))(be||{}),Ct=o(28744),St=Object.defineProperty,bt=Object.defineProperties,Et=Object.getOwnPropertyDescriptors,$e=Object.getOwnPropertySymbols,jt=Object.prototype.hasOwnProperty,Nt=Object.prototype.propertyIsEnumerable,Ze=(e,s,n)=>s in e?St(e,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[s]=n,It=(e,s)=>{for(var n in s||(s={}))jt.call(s,n)&&Ze(e,n,s[n]);if($e)for(var n of $e(s))Nt.call(s,n)&&Ze(e,n,s[n]);return e},Mt=(e,s)=>bt(e,Et(s));const Ot=()=>{const e=(0,v.Zp)(),{selectedFiat:s,setSelectedFiat:n,selectedCrypto:a,isP2PBuy:r,p2pConfig:l,isP2PConfigLoading:c}=ee(),{currencies:i,isLoading:d}=ze(r?void 0:a?.assetId),y=()=>r?"?mode=p2p":"",m=(0,h.useMemo)(()=>!r||!l?.supportedCurrencies?[]:l.supportedCurrencies.map(A=>{var E,b;return{fiatCurrency:A.fiatCurrency,badges:(b=(E=A.badges)==null?void 0:E.map(P=>P===be.LOCAL?Be.H.LOCAL:P===be.LAST_USED?Be.H.LAST_USED:P))!=null?b:[]}}),[r,l?.supportedCurrencies]),x=(0,h.useMemo)(()=>i.map(A=>({fiatCurrency:A.fiatCurrency,badges:A.badges})),[i]),S=r?m:x,Q=r?c:d,D=()=>{e(-1)},w=A=>{var E;if(r){const b=(E=l?.supportedCurrencies)==null?void 0:E.find(P=>P.fiatCurrency===A);b&&(n({fiatCurrency:A,amount:b.defaultAmount,symbol:A,minAmount:parseFloat(b.minAmount),maxAmount:parseFloat(b.maxAmount),defaultAmount:parseFloat(b.defaultAmount),suggestedAmounts:b.suggestedAmounts}),e(W.b.BUY_NEW+"/enter-amount"+y()))}else{const b=i.find(P=>P.fiatCurrency===A);b&&(n(Mt(It({},b),{amount:b.defaultAmount.toString(),symbol:A})),e(W.b.BUY_NEW+"/enter-amount"+y()))}};return(0,t.jsx)(Ct.q,{onBackAction:D,selectedFiatCurrency:s.symbol,onSelectCurrency:w,currencies:S,isLoading:Q})};var Bt=o(6475),ye=o(73208),Rt=o(75485),Lt=(e,s,n)=>new Promise((a,r)=>{var l=d=>{try{i(n.next(d))}catch(y){r(y)}},c=d=>{try{i(n.throw(d))}catch(y){r(y)}},i=d=>d.done?a(d.value):Promise.resolve(d.value).then(l,c);i((n=n.apply(e,s)).next())});const Dt=20,Ft=({tab:e,network:s,query:n,limit:a=Dt,enabled:r=!0,isP2PBuy:l=!1,p2pAssets:c=[],blockchainsByCoinId:i={}})=>{const d=f=>{const u={};if(n)return u.query=n,u.allNetwork=s,u.allLimit=a,u.allOffset=f,u;switch(e){case ye.l.ALL:u.allNetwork=s,u.allLimit=a,u.allOffset=f;break;case ye.l.TOP_100:u.top100Network=s,u.top100Limit=a,u.top100Offset=f;break;case ye.l.STABLES:u.stablecoinsNetwork=s,u.stablecoinsLimit=a,u.stablecoinsOffset=f;break}return u},y=f=>{if(n)return f.all;switch(e){case ye.l.ALL:return f.all;case ye.l.TOP_100:return f.top100;case ye.l.STABLES:return f.stablecoins;default:return f.all}},x=(()=>{if(!l||!c.length)return[];const f=(n??"").toLowerCase();return f?c.filter(u=>{var p,I;if(u.symbol.toLowerCase().includes(f)||u.network.toLowerCase().includes(f))return!0;const C=(0,Rt.X2)(u.assetId,!0),R=i[C];return((I=(p=R?.displayName)!=null?p:R?.name)!=null?I:"").toLowerCase().includes(f)}):c})(),{data:S,isFetching:Q,isFetchingNextPage:D,error:w,refetch:A,fetchNextPage:E,hasNextPage:b}=(0,Bt.q)({queryKey:["buy-crypto-assets",e,s,n,a],queryFn:f=>Lt(null,[f],function*({pageParam:u}){const{offset:p}=u;return Y.YW.emit($.A.GET_BUY_CRYPTO_ASSETS,d(p))}),initialPageParam:{offset:0},getNextPageParam:(f,u)=>{const p=y(f);if(!p)return;const I=u.reduce((C,R)=>{var M,O;const j=y(R);return C+((O=(M=j?.docs)==null?void 0:M.length)!=null?O:0)},0);if(!(I>=p.total))return{offset:I}},refetchOnWindowFocus:!1,staleTime:1e3*60*5,gcTime:1e3*60*10,enabled:r&&!l}),B=S?.pages?S.pages.flatMap(f=>{var u,p;return(p=(u=y(f))==null?void 0:u.docs)!=null?p:[]}):[],J=(()=>{var f,u,p;return l?x.length:(f=S?.pages)!=null&&f[0]&&(p=(u=y(S.pages[0]))==null?void 0:u.total)!=null?p:0})(),N=(()=>{var f,u,p;if(!l&&!(e!==ye.l.ALL||n))return(p=(u=(f=S?.pages)==null?void 0:f[0])==null?void 0:u.recentlyPurchased)==null?void 0:p.docs})();return{assets:B,p2pAssets:x,total:J,recentlyPurchased:N,isLoading:l?!1:Q&&!S,isFetchingNextPage:D,error:w,refetch:A,fetchNextPage:E,hasNextPage:l?!1:b??!1}};var Tt=o(41393),wt=o(87841),Ut=o(75985),De=o(42151),Xe=o(61383),Fe=o(33926);const Je=()=>{var e;const s=(0,v.Zp)(),n=(0,v.zy)(),{formatMessage:a}=(0,q.A)(),{selectedCrypto:r,setSelectedCrypto:l,selectedNetwork:c,isP2PBuy:i,p2pConfig:d,selectedFiat:y,isP2PConfigLoading:m}=ee(),x=n.pathname===W.b.BUY_NEW,[S,Q]=(0,h.useState)(ye.l.ALL),[D,w]=(0,h.useState)(""),A=(0,Ut.d)(D,De.e1),E=j=>{const ce=j.target.value;w(ce)},b=(0,wt.w)(),{assets:P,p2pAssets:B,recentlyPurchased:L,isLoading:J,hasNextPage:F,fetchNextPage:N}=Ft({tab:S,network:(e=c?.coinId)!=null?e:void 0,query:A||void 0,isP2PBuy:i,p2pAssets:d?.currencySupportedAssets,blockchainsByCoinId:b}),f=i?window.innerHeight-De.v1:window.innerHeight-De.ht,u=!i&&!A&&L&&L.length>0,p=()=>{s(-1)},I=()=>i?"?mode=p2p":"",C=j=>{var ce;const ue=i?B.find(pe=>pe.assetId===j):(ce=P.find(pe=>pe.assetId===j))!=null?ce:L?.find(pe=>pe.assetId===j);if(!ue)return;const ne=(0,Tt.e9)(ue,b);ne&&(l(ne),s(x?W.b.BUY_NEW+"/enter-amount"+I():-1))},R=j=>{Q(j)},M=i?m:J,O=!M&&P.length===0&&!u&&!i;return i?(0,t.jsxs)(Xe.b,{onBackAction:p,searchText:D,onSearchChange:E,selectedNetwork:c,networkFilterNavigateTo:`${W.b.BUY_NEW}/select-network`,selectedAssetId:r?.assetId,isLoading:m,isEmpty:B.length===0&&!m,hasMore:!1,onLoadMore:()=>{},scrollableAreaHeight:f,children:[(0,t.jsx)(T.E,{theme:g.Il.THIRD,children:a({id:"buy-select-crypto.p2p-assets-title",defaultMessage:"Available to {fiat} pair"},{fiat:y?.symbol})}),B.map(j=>(0,t.jsx)(Fe.A,{asset:j,onClick:()=>C(j.assetId)},j.assetId))]}):(0,t.jsxs)(Xe.b,{onBackAction:p,searchText:D,onSearchChange:E,showTabs:!0,selectedTab:S,onTabChange:R,selectedNetwork:c,networkFilterNavigateTo:`${W.b.BUY_NEW}/select-network`,selectedAssetId:r?.assetId,isLoading:M,isEmpty:O,hasMore:F,onLoadMore:N,scrollableAreaHeight:f,children:[u&&L&&L.length>0&&(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)(T.E,{theme:g.Il.THIRD,testid:"recently-purchased-title",children:a({id:"buy-select-crypto.recently-purchased",defaultMessage:"Recently purchased"})}),L.map(j=>(0,t.jsx)(Fe.A,{asset:j,onClick:()=>C(j.assetId)},`recent-${j.assetId}`))]}),P.length>0&&(0,t.jsxs)("div",{children:[u&&L&&L.length>0&&(0,t.jsx)(T.E,{theme:g.Il.THIRD,testid:"all-assets-title",children:a({id:"buy-select-crypto.all-assets",defaultMessage:"All assets"})}),P.map(j=>(0,t.jsx)(Fe.A,{asset:j,onClick:()=>C(j.assetId)},j.assetId))]})]})};var Yt=o(73632);const Qt=()=>{const{selectedNetwork:e,setSelectedNetwork:s}=ee();return(0,t.jsx)(Yt.A,{selectedNetwork:e,setSelectedNetwork:s})};var Wt=o(29618),Gt=o(14940);const Kt=()=>{var e,s,n,a;const r=(0,v.Zp)(),{formatMessage:l}=(0,q.A)(),{selectedCrypto:c,selectedFiat:i,selectedProvider:d,setSelectedProvider:y,selectedPaymentCategory:m,setSelectedPaymentCategory:x}=ee(),{providersByCategory:S,paymentCategories:Q,bestQuote:D,defaultCategory:w,isLoading:A,isError:E}=te({assetId:(e=c?.assetId)!=null?e:"",currency:(s=i?.symbol)!=null?s:"USD",amount:(n=i?.amount)!=null?n:"0",enabled:!!c?.assetId&&!!i?.amount&&i.amount!=="0"});(0,h.useEffect)(()=>{!m&&w&&x(w)},[m,w,x]);const P=(()=>{var p;if(!m)return[];const I=S.find(C=>C.category.id===m.id);return(p=I?.quotes)!=null?p:[]})(),L=(()=>{var p;if(!d)return null;const I=P.find(C=>C.provider.name===d.provider.name&&C.paymentMethod.paymentMethod===d.paymentMethod.paymentMethod&&C.paymentMethod.categoryId===d.paymentMethod.categoryId);return(p=I?.id)!=null?p:null})(),J=()=>{r(-1)},F=p=>{const I=P.find(C=>C.id===p);I&&(y(I),r(-1))},N=()=>{r(W.b.BUY_NEW+"/select-payment-method")},f=(a=L??D?.id)!=null?a:"",u=m?{displayName:m.displayName,imageUrl:m.imageUrl,isTemplateImage:m.isTemplateImage,onSelect:N}:void 0;return(0,t.jsx)(Wt.d,{onBackAction:J,selectedQuoteId:f,onSelectProvider:F,isLoading:A,isError:E,hasQuotes:Q.length>0,paymentMethod:u,children:P.length===0?(0,t.jsx)("div",{className:"flex flex-col items-center justify-center py-8",children:(0,t.jsx)(T.E,{type:g.jK.BODY_14,theme:g.Il.SECONDARY,children:l({id:"select-provider.no-providers-for-method",defaultMessage:"No providers available for this payment method."})})}):P.map(p=>(0,t.jsx)(Gt.h,{id:p.id,providerName:p.provider.name,providerIcon:p.provider.imageUrl,cryptoAmount:p.digitalMoney.amount,cryptoCurrency:p.digitalMoney.currency,badgeText:p.badges.includes(X.BestPrice)?l({id:"select-provider.best-quote",defaultMessage:"Best quote"}):void 0,onClick:()=>F(p.id)},p.id))})};var Vt=o(79830),_e=o(7668),Ht=o(97726),kt=o(46729);const zt=({category:e})=>(0,t.jsx)(_e.sx,{value:e.id,className:"cursor-pointer",children:({checked:s})=>(0,t.jsxs)("div",{className:"flex items-center justify-between py-4",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[e.imageUrl?(0,t.jsx)("img",{src:e.imageUrl,alt:e.displayName,width:40,height:40,className:e.isTemplateImage?"dark:invert":""}):(0,t.jsx)("div",{className:"w-10 h-10 rounded-full bg-background-secondary flex items-center justify-center",children:(0,t.jsx)(T.E,{type:g.jK.SUBHEADER_16,weight:g.nG.SEMIBOLD,children:e.displayName.charAt(0)})}),(0,t.jsx)(T.E,{type:g.jK.TITLE,theme:g.Il.PRIMARY,weight:g.nG.SEMIBOLD,children:e.displayName})]}),(0,t.jsx)("div",{className:"flex items-center",children:s?(0,t.jsx)(Ht.w,{width:24,height:24,colorClass:"text-brand-primary"}):(0,t.jsx)(kt.r,{width:24,height:24,colorClass:"text-icon-disabled"})})]})}),$t=()=>{var e,s,n,a;const r=(0,v.Zp)(),{formatMessage:l}=(0,q.A)(),{selectedCrypto:c,selectedFiat:i,selectedPaymentCategory:d,setSelectedPaymentCategory:y,setSelectedProvider:m}=ee(),{paymentCategories:x,providersByCategory:S,isLoading:Q,isError:D}=te({assetId:(e=c?.assetId)!=null?e:"",currency:(s=i?.symbol)!=null?s:"USD",amount:(n=i?.amount)!=null?n:"0",enabled:!!c?.assetId&&!!i?.amount&&i.amount!=="0"}),w=()=>{r(-1)},A=E=>{const b=x.find(P=>P.id===E);if(b){y(b);const P=S.find(B=>B.category.id===E);P?.recommendedQuote?m(P.recommendedQuote):P?.quotes[0]&&m(P.quotes[0]),r(-1)}};return(0,t.jsxs)(Z.LN,{wide:!0,children:[(0,t.jsx)(Z.zY,{backAction:w,title:l({id:"buy-select-payment-method.title",defaultMessage:"Payment methods"})}),(0,t.jsx)(Z.Gv,{children:Q?(0,t.jsx)("div",{className:"flex justify-center py-8",children:(0,t.jsx)(Vt.y,{})}):D?(0,t.jsx)("div",{className:"flex flex-col items-center justify-center py-8",children:(0,t.jsx)(T.E,{type:g.jK.BODY_14,theme:g.Il.SECONDARY,children:l({id:"buy-select-payment-method.error",defaultMessage:"Failed to load payment methods. Please try again."})})}):x.length===0?(0,t.jsx)("div",{className:"flex flex-col items-center justify-center py-8",children:(0,t.jsx)(T.E,{type:g.jK.BODY_14,theme:g.Il.SECONDARY,children:l({id:"buy-select-payment-method.no-methods",defaultMessage:"No payment methods available."})})}):(0,t.jsx)(_e.z6,{value:(a=d?.id)!=null?a:"",onChange:A,children:x.map(E=>(0,t.jsx)(zt,{category:E},E.id))})})]})},Zt=()=>{var e,s,n,a;const{data:r,isFetching:l,error:c,refetch:i}=(0,U.I)({queryKey:["p2p-buy-crypto-config"],queryFn:()=>Y.YW.emit($.A.GET_P2P_BUY_CRYPTO_CONFIG),retry:2,refetchOnWindowFocus:!1,staleTime:3e5,gcTime:6e5});return{config:r??null,selectedAsset:(e=r?.selectedAsset)!=null?e:null,supportedCurrencies:(s=r?.supportedCurrencies)!=null?s:[],currencySupportedAssets:(n=r?.currencySupportedAssets)!=null?n:[],providers:(a=r?.providers)!=null?a:[],isLoading:l&&!r,error:c,refetch:i}},Re="USD",Xt=e=>{const s=e.find(r=>{var l;return(l=r.badges)==null?void 0:l.includes(Be.H.LAST_USED)});if(s)return s;const n=e.find(r=>{var l;return(l=r.badges)==null?void 0:l.includes(Be.H.LOCAL)});if(n)return n;const a=e.find(r=>r.fiatCurrency===Re);return a||e[0]},Jt=({children:e,mode:s=le.REGULAR})=>{const n=s===le.P2P,[a,r]=(0,h.useState)(null),[l,c]=(0,h.useState)(null),[i,d]=(0,h.useState)(null),[y,m]=(0,h.useState)(null),{config:x,isLoading:S}=Zt(),{currencies:Q}=ze(n?void 0:a?.assetId),[D,w]=(0,h.useState)({fiatCurrency:Re,defaultAmount:0,minAmount:0,maxAmount:0,suggestedAmounts:[],amount:"",symbol:Re}),[A,E]=(0,h.useState)(null),[b,P]=(0,h.useState)(!1);(0,h.useEffect)(()=>{var F,N,f,u,p,I;if(!n||!x||b)return;const C=x.supportedCurrencies;if(!C.length)return;const R=(u=(f=(N=(F=C.find(M=>{var O;return(O=M.badges)==null?void 0:O.includes(be.DEFAULT)}))!=null?F:C.find(M=>{var O;return(O=M.badges)==null?void 0:O.includes(be.LAST_USED)}))!=null?N:C.find(M=>{var O;return(O=M.badges)==null?void 0:O.includes(be.LOCAL)}))!=null?f:C.find(M=>M.fiatCurrency===Re))!=null?u:C[0];if(R){const M=R.fiatCurrency;w({fiatCurrency:M,defaultAmount:parseFloat(R.defaultAmount),minAmount:parseFloat(R.minAmount),maxAmount:parseFloat(R.maxAmount),suggestedAmounts:(p=R.suggestedAmounts)!=null?p:[],badges:(I=R.badges)==null?void 0:I.map(O=>O),amount:R.defaultAmount,symbol:M}),P(!0)}},[n,x,b]),(0,h.useEffect)(()=>{var F;if(n||!Q.length||!a?.assetId||A===a.assetId)return;const N=Xt(Q);N&&(w({fiatCurrency:N.fiatCurrency,defaultAmount:N.defaultAmount,minAmount:N.minAmount,maxAmount:N.maxAmount,suggestedAmounts:(F=N.suggestedAmounts)!=null?F:[],badges:N.badges,amount:N.defaultAmount.toString(),symbol:N.fiatCurrency}),E(a.assetId),d(null),m(null))},[n,Q,a?.assetId,A]);const B=F=>{w(N=>(N.amount!==F.amount&&d(null),F))},L=F=>{r(F),d(null),m(null),E(null)},J=(0,h.useMemo)(()=>({buyFlowMode:s,isP2PBuy:n,p2pConfig:n?x:null,isP2PConfigLoading:n?S:!1,selectedFiat:D,setSelectedFiat:B,selectedCrypto:a,setSelectedCrypto:L,selectedNetwork:l,setSelectedNetwork:c,selectedProvider:i,setSelectedProvider:d,selectedPaymentCategory:y,setSelectedPaymentCategory:m}),[s,n,x,S,D,B,a,L,l,i,y]);return(0,t.jsx)(ie.Provider,{value:J,children:e})};var _t=o(84118),qt=o(84206);const en=()=>{const[e]=(0,V.ok)(),n=e.get("mode")==="p2p"?le.P2P:le.REGULAR,{enabled:a}=(0,_t.x)(qt.t);return a?(0,t.jsx)(Jt,{mode:n,children:(0,t.jsxs)(v.BV,{children:[(0,t.jsx)(v.qh,{index:!0,element:(0,t.jsx)(Je,{})}),(0,t.jsx)(v.qh,{path:"/enter-amount",element:(0,t.jsx)(At,{})}),(0,t.jsx)(v.qh,{path:"/select-fiat",element:(0,t.jsx)(Ot,{})}),(0,t.jsx)(v.qh,{path:"/select-crypto",element:(0,t.jsx)(Je,{})}),(0,t.jsx)(v.qh,{path:"/select-network",element:(0,t.jsx)(Qt,{})}),(0,t.jsx)(v.qh,{path:"/select-provider",element:(0,t.jsx)(Kt,{})}),(0,t.jsx)(v.qh,{path:"/select-payment-method",element:(0,t.jsx)($t,{})})]})}):(0,t.jsx)(v.C5,{to:W.b.BUY,state:{showBackButton:!0}})}}),42430:((z,K,o)=>{o.d(K,{A:()=>T});var t=o(74848),V=o(53982),v=o(4751),Z=o(64145),q=o(97286),h=o(11711),G=o(85655),H=o(98939);const se=g=>{var k,U,Y,$,de,X,te,Ae,Ce;const oe=(0,G.nK)(H.hF.Ethereum.toString()),{data:ae,isPending:Ee,isError:Ie}=(0,q.I)({queryKey:["vip-tier-data",oe?.address],queryFn:()=>Z.YW.emit(h.A.FETCH_USER_VIP_TIER_DATA,{address:oe?.address}),enabled:!!oe?.address}),Me=(U=(k=ae?.data)==null?void 0:k.vip_tier_level)!=null?U:V.j.NONE,Oe=(de=($=(Y=ae?.data)==null?void 0:Y.vip_config)==null?void 0:$.vip_tiers)==null?void 0:de.find(Ne=>Ne.level===Me),je=(Ae=(te=(X=ae?.data)==null?void 0:X.vip_config)==null?void 0:te.vip_benefits)==null?void 0:Ae.find(Ne=>Ne.id===g);return{feesDiscountPercentage:(Ce=je?.properties[Me])==null?void 0:Ce.value,vipTier:Oe,isPendingVipData:Ee,isErrorVipData:Ie}};var he=o(22146),Pe=o(65512),W=o(52619),le=o(23350),ie=o(28898),ee=o(15314),xe=o(6442);const re=({opened:g,vipTier:k,feesDiscountPercentage:U,onClose:Y})=>{const{theme:$}=(0,ie.h)(),{formatMessage:de}=(0,xe.A)();if(!k)return null;const X=$===ee.W.DARK?k.icon_dark:k.icon_light,te=()=>{window.open("https://trustwallet.com/blog/announcements/introducing-trust-premium","_blank","noopener,noreferrer"),Y()};return(0,t.jsx)(he.a,{opened:g,onClose:Y,title:`${k.display_name} benefit`,placement:le.Gn.CENTER,centerTitle:!0,children:(0,t.jsxs)("div",{className:"flex flex-col items-center space-y-6 py-4",children:[(0,t.jsx)("div",{className:"w-32 h-32 flex items-center justify-center",children:(0,t.jsx)("img",{src:X,alt:`${k.display_name} tier`,className:"w-full h-full"})}),(0,t.jsx)("p",{className:"text-center text-body3 font-medium leading-subtitle4 text-utility-1-opacity-2 px-4",children:de({id:"vip.modal-benefits-description",defaultMessage:"You're currently enjoying {feesDiscountPercentage}% off fees with your Trust Premium {displayName} benefits. Tap below to learn more about your Premium status and discover additional perks."},{displayName:k?.display_name,feesDiscountPercentage:U})}),(0,t.jsx)(Pe.$,{theme:W.ry.PRIMARY,size:W.Vp.LARGE,onClick:te,fullWidth:!0,children:"Learn more"})]})})};var Se=o(96540);const T=({vipBenefitsId:g})=>{var k;const{vipTier:U,feesDiscountPercentage:Y,isPendingVipData:$,isErrorVipData:de}=se(g),[X,te]=(0,Se.useState)(!1),{formatMessage:Ae}=(0,xe.A)(),Ce=U?.level===V.j.SILVER,oe=U?.level===V.j.GOLD,ae=Ce?"border-other-Silver":"border-other-Gold";return(Ce||oe)&&!$&&!de?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:`py-3 px-4 rounded-4 flex items-center gap-2 bg-background-2 border-2 ${ae} cursor-pointer hover:opacity-80 transition-opacity`,onClick:()=>te(!0),children:[(0,t.jsx)(v.hu,{tier:(k=U?.level)==null?void 0:k.toString(),width:24,height:24}),(0,t.jsx)("span",{className:"text-caption1 font-semibold text-utility-1-opacity-1",children:Ae({id:"vip.banner-benefits",defaultMessage:"{displayName} benefit: {feesDiscountPercentage}% off on fees applied."},{displayName:U?.display_name,feesDiscountPercentage:Y})})]}),(0,t.jsx)(re,{opened:X,vipTier:U,feesDiscountPercentage:Y,onClose:()=>te(!1)})]}):null}}),53982:((z,K,o)=>{o.d(K,{j:()=>V,n:()=>t});var t=(v=>(v.TWT_GAS_RAMP="zero_gas_twt_ramp",v.TWT_GAS_FEE_DISCOUNT="twt_gas_fee_discount",v.SWAP_FEE_DISCOUNT="swap_fee_discount",v.ONRAMP_FEE_DISCOUNT="on_ramp_fee_discount",v.OFFRAMP_FEE_DISCOUNT="off_ramp_fee_discount",v.TRUST_ALPHA_ACCESS="trust_alpha_access",v.COMMUNITY_AIRDROP="community_airdrop",v))(t||{}),V=(v=>(v[v.NONE=0]="NONE",v[v.BRONZE=1]="BRONZE",v[v.SILVER=2]="SILVER",v[v.GOLD=3]="GOLD",v))(V||{})}),84206:((z,K,o)=>{o.d(K,{t:()=>t});const t={name:"onramp-revamp",default:!1}})}]);

//# sourceMappingURL=712.js.map